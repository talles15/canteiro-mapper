<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>🌱 Mapeamento de Canteiros</title>
  <link rel="stylesheet" href="./css/styles.css"/>
  <!-- Dependências externas (UMD) -->
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/qr-scanner/1.4.2/qr-scanner.umd.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- App -->
  <script type="module" defer src="./js/app.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>🌱 Sistema de Mapeamento de Canteiros</h1>
      <p>Controle de plantio de testes com QR Code</p>
    </div>

    <!-- Menu Principal -->
    <div id="main-menu" class="main-menu">
      <div class="menu-buttons">
        <button class="menu-btn menu-btn-primary" data-action="novo-canteiro">
          <span class="emoji">🆕</span>
          <span>Novo Canteiro</span>
        </button>
        <button class="menu-btn menu-btn-secondary" data-action="listar-canteiros">
          <span class="emoji">📂</span>
          <span>Canteiros Salvos</span>
        </button>
        <button class="menu-btn menu-btn-info" data-action="importar-dados">
          <span class="emoji">📥</span>
          <span>Importar Dados</span>
        </button>
      </div>

      <div id="saved-canteiros-list" class="saved-canteiros" hidden>
        <h3>📋 Canteiros Salvos:</h3>
        <div id="canteiros-container"></div>
      </div>
    </div>

    <!-- Painel de Configuração -->
    <div id="setup-panel" class="setup-panel" hidden>
      <div class="form-grid">
        <div class="form-group">
          <label for="canteiro-num">Número do Canteiro</label>
          <input type="text" id="canteiro-num" placeholder="Ex: C001" required>
        </div>

        <div class="form-group">
          <label for="data-plantio">Data do Plantio</label>
          <input type="date" id="data-plantio" required>
        </div>

        <div class="form-group">
          <label for="tipo-teste">Tipo de Teste</label>
          <select id="tipo-teste" required>
            <option value="">Selecione...</option>
            <option value="GA">GA - Germinação</option>
            <option value="EA48">EA48 - Envelhecimento 48h</option>
            <option value="EA72">EA72 - Envelhecimento 72h</option>
          </select>
        </div>

        <div class="form-group">
          <label>Lado do Canteiro para Iniciar</label>
          <div class="lado-buttons">
            <button class="lado-btn" data-lado="esquerdo">⬅️ Esquerdo</button>
            <button class="lado-btn active" data-lado="direito">Direito ➡️</button>
          </div>
        </div>
      </div>

      <div class="buttons">
        <button class="btn btn-primary" data-action="iniciar-scan">📱 Leitura QR</button>
        <button class="btn btn-secondary" data-action="entrada-manual">✏️ Entrada Manual</button>
        <button class="btn btn-info" data-action="voltar-menu">🏠 Menu</button>
      </div>
    </div>

    <!-- Painel de Leitura QR -->
    <div id="scanning-panel" class="scanning-panel" hidden>
      <div class="status-bar">
        <span id="scan-status">Preparando câmera...</span>
      </div>

      <div class="camera-container">
        <video id="qr-video"></video>
        <div class="scanning-overlay"></div>
      </div>

      <div class="progress-info">
        <strong>Amostras Lidas: <span id="sample-count">0</span>/90</strong><br>
        <small>Lado atual: <span id="current-side">Direito</span></small>
      </div>

      <div class="scan-info">
        <p><strong>📋 Como usar:</strong></p>
        <p>1. Posicione o QR code dentro do quadrado verde</p>
        <p>2. O código será lido automaticamente</p>
        <p>3. A amostra será adicionada na sequência</p>
        <p><small>💡 Capacidade: 90 amostras (45 por lado)</small></p>
      </div>

      <div class="buttons">
        <button class="btn btn-secondary" data-action="trocar-lado">🔄 Trocar Lado</button>
        <button class="btn btn-primary" data-action="finalizar-scan">✅ Finalizar</button>
        <button class="btn btn-danger" data-action="parar-scan">❌ Parar</button>
      </div>
    </div>

    <!-- Painel de Entrada Manual -->
    <div id="manual-entry-panel" class="manual-entry-panel" hidden>
      <div class="manual-form">
        <h3 class="titulo-form">📝 Entrada Manual de Amostra</h3>

        <div class="form-group">
          <label for="manual-codigo">Códigos das Amostras</label>
          <input type="text" id="manual-codigo" placeholder="Ex: 10;20;30 ou apenas 10">
          <small class="hint">
            💡 <strong>Múltiplas amostras:</strong> Separe por ponto e vírgula (;)<br>
            📋 <strong>Exemplo:</strong> 10;20;30 (criará 3 amostras sequenciais)
          </small>
        </div>

        <div class="form-group">
          <label for="manual-tipo-teste-individual">Tipo de Teste</label>
          <select id="manual-tipo-teste-individual">
            <option value="">Selecione...</option>
            <option value="GA">GA - Germinação</option>
            <option value="EA48">EA48 - Envelhecimento 48h</option>
            <option value="EA72">EA72 - Envelhecimento 72h</option>
          </select>
          <small class="hint">
            💡 <strong>Flexibilidade:</strong> Cada amostra pode ter um tipo de teste diferente
          </small>
        </div>

        <div class="form-group">
          <label for="manual-tipo-remessa">Origem da Amostra</label>
          <select id="manual-tipo-remessa">
            <option value="">Selecione...</option>
            <option value="Lote">Lote</option>
            <option value="TSI">TSI</option>
            <option value="Carregamento">Carregamento</option>
            <option value="Teste">Teste</option>
            <option value="Reclamação">Reclamação</option>
            <option value="Entrada de Semente">Entrada de Semente</option>
          </select>
        </div>

        <div class="form-group">
          <label for="manual-lado">Lado do Canteiro</label>
          <select id="manual-lado">
            <option value="direito">Direito</option>
            <option value="esquerdo">Esquerdo</option>
          </select>
        </div>

        <div class="form-group">
          <label for="manual-posicao">Posição Inicial</label>
          <input type="number" id="manual-posicao" min="1" placeholder="Ex: 1">
          <small class="hint">
            📍 <strong>Posição inicial:</strong> Amostras múltiplas serão colocadas em sequência<br>
            📋 <strong>Exemplo:</strong> Posição 1 → amostras nas posições 1, 2, 3...
          </small>
        </div>

        <div id="preview-area" class="preview-area" hidden>
          <strong>📋 Preview das amostras:</strong>
          <div id="preview-content"></div>
        </div>

        <div class="buttons">
          <button class="btn btn-primary" data-action="adicionar-manual">➕ Adicionar</button>
          <button class="btn btn-secondary" data-action="preview-manual">👁️ Preview</button>
          <button class="btn btn-secondary" data-action="voltar-setup">⬅️ Voltar</button>
        </div>
      </div>
    </div>

    <!-- Painel do Mapa -->
    <div id="map-panel" class="map-panel" hidden>
      <div class="canteiro-info">
        <h3 id="canteiro-title">Mapa do Canteiro</h3>
        <p id="canteiro-details">Detalhes do plantio</p>
      </div>

      <table class="map-table" id="mapa-table">
        <thead>
          <tr>
            <th>Posição</th>
            <th>Lado Esquerdo</th>
            <th>Lado Direito</th>
          </tr>
        </thead>
        <tbody id="mapa-tbody"></tbody>
      </table>

      <div class="buttons">
        <button class="btn btn-primary" data-action="continuar-adicionando">➕ Continuar Adicionando</button>
        <button class="btn btn-secondary" data-action="entrada-manual">✏️ Entrada Manual</button>
        <button class="btn btn-warning" data-action="limpar-canteiro">🧹 Limpar Canteiro</button>
        <button class="btn btn-info" data-action="exportar-json">📄 Exportar JSON</button>
        <button class="btn btn-info" data-action="exportar-pdf">📑 Exportar PDF</button>
        <button class="btn btn-secondary" data-action="voltar-menu">🏠 Menu</button>
      </div>
    </div>
  </div>

  <!-- Modal de Confirmação -->
  <dialog id="confirmModal">
    <form method="dialog" class="modal-content">
      <h3 id="modal-title">Confirmar Ação</h3>
      <p id="modal-message">Tem certeza?</p>
      <div class="buttons">
        <button class="btn btn-danger" value="confirm">Confirmar</button>
        <button class="btn btn-secondary" value="cancel">Cancelar</button>
      </div>
    </form>
  </dialog>

  <!-- Input oculto para importar arquivos -->
  <input type="file" id="import-input" accept=".json" hidden>
</body>
</html>
