<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸŒ± Mapeamento de Canteiros</title>
  <link rel="stylesheet" href="./css/styles.css"/>
  <!-- DependÃªncias externas (UMD) -->
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/qr-scanner/1.4.2/qr-scanner.umd.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- App -->
  <script type="module" defer src="./js/app.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸŒ± Sistema de Mapeamento de Canteiros</h1>
      <p>Controle de plantio de testes com QR Code</p>
    </div>

    <!-- Menu Principal -->
    <div id="main-menu" class="main-menu">
      <div class="menu-buttons">
        <button class="menu-btn menu-btn-primary" data-action="novo-canteiro">
          <span class="emoji">ğŸ†•</span>
          <span>Novo Canteiro</span>
        </button>
        <button class="menu-btn menu-btn-secondary" data-action="listar-canteiros">
          <span class="emoji">ğŸ“‚</span>
          <span>Canteiros Salvos</span>
        </button>
        <button class="menu-btn menu-btn-info" data-action="importar-dados">
          <span class="emoji">ğŸ“¥</span>
          <span>Importar Dados</span>
        </button>
      </div>

      <div id="saved-canteiros-list" class="saved-canteiros" hidden>
        <h3>ğŸ“‹ Canteiros Salvos:</h3>
        <div id="canteiros-container"></div>
      </div>
    </div>

    <!-- Painel de ConfiguraÃ§Ã£o -->
    <div id="setup-panel" class="setup-panel" hidden>
      <div class="form-grid">
        <div class="form-group">
          <label for="canteiro-num">NÃºmero do Canteiro</label>
          <input type="text" id="canteiro-num" placeholder="Ex: C001" required>
        </div>

        <div class="form-group">
          <label for="data-plantio">Data do Plantio</label>
          <input type="date" id="data-plantio" required>
        </div>

        <div class="form-group">
          <label for="tipo-teste">Tipo de Teste</label>
          <select id="tipo-teste" required>
            <option value="">Selecione...</option>
            <option value="GA">GA - GerminaÃ§Ã£o</option>
            <option value="EA48">EA48 - Envelhecimento 48h</option>
            <option value="EA72">EA72 - Envelhecimento 72h</option>
          </select>
        </div>

        <div class="form-group">
          <label>Lado do Canteiro para Iniciar</label>
          <div class="lado-buttons">
            <button class="lado-btn" data-lado="esquerdo">â¬…ï¸ Esquerdo</button>
            <button class="lado-btn active" data-lado="direito">Direito â¡ï¸</button>
          </div>
        </div>
      </div>

      <div class="buttons">
        <button class="btn btn-primary" data-action="iniciar-scan">ğŸ“± Leitura QR</button>
        <button class="btn btn-secondary" data-action="entrada-manual">âœï¸ Entrada Manual</button>
        <button class="btn btn-info" data-action="voltar-menu">ğŸ  Menu</button>
      </div>
    </div>

    <!-- Painel de Leitura QR -->
    <div id="scanning-panel" class="scanning-panel" hidden>
      <div class="status-bar">
        <span id="scan-status">Preparando cÃ¢mera...</span>
      </div>

      <div class="camera-container">
        <video id="qr-video"></video>
        <div class="scanning-overlay"></div>
      </div>

      <div class="progress-info">
        <strong>Amostras Lidas: <span id="sample-count">0</span>/90</strong><br>
        <small>Lado atual: <span id="current-side">Direito</span></small>
      </div>

      <div class="scan-info">
        <p><strong>ğŸ“‹ Como usar:</strong></p>
        <p>1. Posicione o QR code dentro do quadrado verde</p>
        <p>2. O cÃ³digo serÃ¡ lido automaticamente</p>
        <p>3. A amostra serÃ¡ adicionada na sequÃªncia</p>
        <p><small>ğŸ’¡ Capacidade: 90 amostras (45 por lado)</small></p>
      </div>

      <div class="buttons">
        <button class="btn btn-secondary" data-action="trocar-lado">ğŸ”„ Trocar Lado</button>
        <button class="btn btn-primary" data-action="finalizar-scan">âœ… Finalizar</button>
        <button class="btn btn-danger" data-action="parar-scan">âŒ Parar</button>
      </div>
    </div>

    <!-- Painel de Entrada Manual -->
    <div id="manual-entry-panel" class="manual-entry-panel" hidden>
      <div class="manual-form">
        <h3 class="titulo-form">ğŸ“ Entrada Manual de Amostra</h3>

        <div class="form-group">
          <label for="manual-codigo">CÃ³digos das Amostras</label>
          <input type="text" id="manual-codigo" placeholder="Ex: 10;20;30 ou apenas 10">
          <small class="hint">
            ğŸ’¡ <strong>MÃºltiplas amostras:</strong> Separe por ponto e vÃ­rgula (;)<br>
            ğŸ“‹ <strong>Exemplo:</strong> 10;20;30 (criarÃ¡ 3 amostras sequenciais)
          </small>
        </div>

        <div class="form-group">
          <label for="manual-tipo-teste-individual">Tipo de Teste</label>
          <select id="manual-tipo-teste-individual">
            <option value="">Selecione...</option>
            <option value="GA">GA - GerminaÃ§Ã£o</option>
            <option value="EA48">EA48 - Envelhecimento 48h</option>
            <option value="EA72">EA72 - Envelhecimento 72h</option>
          </select>
          <small class="hint">
            ğŸ’¡ <strong>Flexibilidade:</strong> Cada amostra pode ter um tipo de teste diferente
          </small>
        </div>

        <div class="form-group">
          <label for="manual-tipo-remessa">Origem da Amostra</label>
          <select id="manual-tipo-remessa">
            <option value="">Selecione...</option>
            <option value="Lote">Lote</option>
            <option value="TSI">TSI</option>
            <option value="Carregamento">Carregamento</option>
            <option value="Teste">Teste</option>
            <option value="ReclamaÃ§Ã£o">ReclamaÃ§Ã£o</option>
            <option value="Entrada de Semente">Entrada de Semente</option>
          </select>
        </div>

        <div class="form-group">
          <label for="manual-lado">Lado do Canteiro</label>
          <select id="manual-lado">
            <option value="direito">Direito</option>
            <option value="esquerdo">Esquerdo</option>
          </select>
        </div>

        <div class="form-group">
          <label for="manual-posicao">PosiÃ§Ã£o Inicial</label>
          <input type="number" id="manual-posicao" min="1" placeholder="Ex: 1">
          <small class="hint">
            ğŸ“ <strong>PosiÃ§Ã£o inicial:</strong> Amostras mÃºltiplas serÃ£o colocadas em sequÃªncia<br>
            ğŸ“‹ <strong>Exemplo:</strong> PosiÃ§Ã£o 1 â†’ amostras nas posiÃ§Ãµes 1, 2, 3...
          </small>
        </div>

        <div id="preview-area" class="preview-area" hidden>
          <strong>ğŸ“‹ Preview das amostras:</strong>
          <div id="preview-content"></div>
        </div>

        <div class="buttons">
          <button class="btn btn-primary" data-action="adicionar-manual">â• Adicionar</button>
          <button class="btn btn-secondary" data-action="preview-manual">ğŸ‘ï¸ Preview</button>
          <button class="btn btn-secondary" data-action="voltar-setup">â¬…ï¸ Voltar</button>
        </div>
      </div>
    </div>

    <!-- Painel do Mapa -->
    <div id="map-panel" class="map-panel" hidden>
      <div class="canteiro-info">
        <h3 id="canteiro-title">Mapa do Canteiro</h3>
        <p id="canteiro-details">Detalhes do plantio</p>
      </div>

      <table class="map-table" id="mapa-table">
        <thead>
          <tr>
            <th>PosiÃ§Ã£o</th>
            <th>Lado Esquerdo</th>
            <th>Lado Direito</th>
          </tr>
        </thead>
        <tbody id="mapa-tbody"></tbody>
      </table>

      <div class="buttons">
        <button class="btn btn-primary" data-action="continuar-adicionando">â• Continuar Adicionando</button>
        <button class="btn btn-secondary" data-action="entrada-manual">âœï¸ Entrada Manual</button>
        <button class="btn btn-warning" data-action="limpar-canteiro">ğŸ§¹ Limpar Canteiro</button>
        <button class="btn btn-info" data-action="exportar-json">ğŸ“„ Exportar JSON</button>
        <button class="btn btn-info" data-action="exportar-pdf">ğŸ“‘ Exportar PDF</button>
        <button class="btn btn-secondary" data-action="voltar-menu">ğŸ  Menu</button>
      </div>
    </div>
  </div>

  <!-- Modal de ConfirmaÃ§Ã£o -->
  <dialog id="confirmModal">
    <form method="dialog" class="modal-content">
      <h3 id="modal-title">Confirmar AÃ§Ã£o</h3>
      <p id="modal-message">Tem certeza?</p>
      <div class="buttons">
        <button class="btn btn-danger" value="confirm">Confirmar</button>
        <button class="btn btn-secondary" value="cancel">Cancelar</button>
      </div>
    </form>
  </dialog>

  <!-- Input oculto para importar arquivos -->
  <input type="file" id="import-input" accept=".json" hidden>
</body>
</html>
